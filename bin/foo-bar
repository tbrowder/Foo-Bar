#!/usr/bin/env raku

use Foo::Bar;

#my $dir      = $*CWD;
my $dir;
my $force    = 0;
my $show     = 0;
my $download = 0;
if not @*ARGS {
    print qq:to/HERE/;
    Usage: {$*PROGRAM.basename} <mode> [...options]

    Shows or downloads files in the /resources directory.
    Downloads are to the current directory unless you
      specify another location.

    Modes:
      s[how]       - list the files in /resources
      d[ownload]   - to the current directory
      d[ownload]=X - to directory X

    Options:
      f[orce]      - allow overwriting an existing file
    HERE
    exit;
}

for @*ARGS {
    when /^ :i f/ {
        ++$force;
    }
    when /^ :i s/ {
        ++$show;
    }
    when /^ :i d \w* '=' (\S+) $/ {
        my $d = ~$0;
        unless $d.IO.d {
            die "FATAL: '$d' is not a usable directory";
        }
        $dir = $d;
    }
    when /^ :i d/ {
        ++$download;
    }
    default {
        say "FATAL: Unknown arg '$_'";
        exit;
    }
}

if $show {
    show-resources-files;
}
elsif $download {
    download-resources-files $dir, :$force;
}

