#!/usr/bin/env raku

use JSON::Fast;
use File::Find;

my $dir = $*CWD; #.IO.parent;
say "\$dir: $dir";


my $mfil = "$dir/META6.json";
my $rdir = "$dir/resources";
my %meta = from-json $mfil.IO.slurp;

my @paths = find :dir($rdir), :type<file>; #.IO.lines;

say "\@paths: ({@paths.elems})";
say "  '$_'" for @paths;

for @paths.kv -> $i, $v {
    
    say "path: $v";

    my @pieces = $v.Str.split('/');
    my $pn = @pieces.elems;

    # path of interest is after first 7 pieces
    say "path pieces: ($pn)";
    my $paridx;
    for @pieces.kv -> $i, $v {
        say "  piece $i: $v";
        if $v eq "resources" {
            $paridx = $i;
        }
    }
    $paridx = 0 if not $paridx.defined;
    my $parent = @pieces[0..$paridx].join('/');
    my $path   = @pieces[$paridx+1..*].join('/');
    say "parent: '$parent'";
    say "  path:   '$path'";
    %meta<resources>.push: $path;
}

say "\%META";
for %meta<resources>.values {
    say "meta/resources child: $_";
}

#say %meta<resources>.gist;

